<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Test</title>
        <script src="assets/lib/jquery-2.2.1.js"></script>
        <script src="/assets/js/api.js"></script>
        <script>
            $(function () {
                function updateDocuments(documents) {
                    documents = documents.documents || [];
                    var tableBody = $('#document-list-body');
                    tableBody.empty();
                    for(var a = 0;a < documents.length;a++) {
                        var doc = $('<tr></tr>');
                        var title = $('<td>');
                        title.append("<a href=\"/api/document?documentId=" + documents[a].id + "\">" + documents[a].title + "</a>");
                        var date = $('<td>');
                        date.text(documents[a].date);
                        doc.append(title);
                        doc.append(date);
                        tableBody.append(doc);
                    }
                }
                function displayError(error) {
                    error = error || {};
                    if(error.error && error.message) {
                        alert(error.message);
                    }
                }
                $('#search-button').click(function () {
                    var old = window.location.hash;
                    var hash = JSON.stringify({
                        type : $('#search-type').val(),
                        query : $('#search-query').val()
                    });
                    window.location.hash = hash;
                    if(old == window.location.hash) {
                        $(window).trigger('hashchange');
                    }
                });

                $(window).bind('hashchange', function() {
                    try {
                        var search = {};
                        if (window.location.hash.replace(/^#/, '') != "") {
                            search = JSON.parse(window.location.hash.replace(/^#/, ''));
                            $('#search-type').val(search.type);
                            $('#search-query').val(search.query);
                        }
                        searchDocument(search.type || "", search.query || "", updateDocuments, displayError);
                    } catch (e) {
                        window.location.hash = "";
                    }
                }).trigger('hashchange');
            });
        </script>
    </head>
    <body>
        <div id="search-box">
            <textarea id="search-query" title="Enter your search query"></textarea>
            <br>
            <select id="search-type" title="Select your search type">
                <option value="fulltext">Fulltext</option>
                <option value="xquery">X-Query</option>
                <option value="logical">Advanced search</option>
            </select>
            <br>
            <input id="search-button" type="button" value="Search" title="Click to search">
        </div>
        <table id="document-list">
            <thead>
                <tr>
                    <td>Document title</td>
                    <td>Date</td>
                </tr>
            </thead>
            <tbody id="document-list-body"></tbody>
        </table>
    </body>
</html>